<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EnviroManage - Special Pickup Requests</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />
  <link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="special.css">
  <style>
    .badge-status {
      font-size: 0.85rem;
      padding: 6px 10px;
    }
    .modal-label {
      font-weight: 600;
    }
    .table td, .table th {
      vertical-align: middle;
    }
      /* Status badge */
  .badge-status {
    font-size: 0.85rem;
    padding: 6px 10px;
  }

  .modal-label {
    font-weight: 600;
  }

  /* Align table content */
  .table td, .table th {
    vertical-align: middle;
  }
  
  

  </style>
</head>
<body>

<!-- ===================== TOP NAVBAR ===================== -->
<nav class="navbar navbar-expand-lg navbar-dark fixed-top" style="height:70px;">
  <div class="container-fluid">
    <a class="navbar-brand d-flex align-items-center" href="#">
      <img src="logo.png" alt="BasuraTrack Logo" style="height:40px;">
    </a>

    <ul class="navbar-nav ms-auto align-items-center">
      <li class="nav-item me-3">
        <a class="nav-link" href="notification.html"><i class="bi bi-bell-fill"></i></a>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
          <i class="bi bi-person-circle"></i> Admin
        </a>
        <ul class="dropdown-menu dropdown-menu-end">
          <li><hr class="dropdown-divider"></li>
          <li>
            <a class="dropdown-item text-center" href="index.html" id="logoutBtn">
              Logout <i class="bi bi-box-arrow-right me-1"></i>
            </a>
          </li>
        </ul>
      </li>
    </ul>
  </div>
</nav>

<!-- ===================== SIDEBAR ===================== -->
<div class="sidebar">
  <nav class="nav flex-column">
    <a class="nav-link" href="dashboard.html"><i class="bi bi-house-door-fill me-2"></i> Dashboard</a>
    <a class="nav-link" href="schedule.html"><i class="bi bi-map-fill me-2"></i> Routes & Schedules</a>
    <a class="nav-link" href="trucks.html"><i class="bi bi-truck-front-fill me-2"></i> Trucks & Collectors</a>
    <a class="nav-link" href="collection.html"><i class="bi bi-trash-fill me-2"></i> Collection Records</a>
    <a class="nav-link active" href="special.html"><i class="bi bi-exclamation-circle-fill me-2"></i> Special Pickup</a>
    <a class="nav-link" href="resident.html"><i class="bi bi-file-earmark-text-fill me-2"></i> Resident Reports</a>
    <a class="nav-link" href="analytics.html"><i class="bi bi-bar-chart-fill me-2"></i> Analytics & Reports</a>
    <a class="nav-link" href="announcements.html"><i class="bi bi-megaphone-fill me-2"></i> Announcements</a>
    <a class="nav-link" href="news.html"><i class="bi bi-newspaper me-2"></i> News & Articles</a>
    <a class="nav-link" href="user.html"><i class="bi bi-people-fill me-2"></i> User Management</a>
    <a class="nav-link" href="settings.html"><i class="bi bi-gear-fill me-2"></i> Settings</a>
  </nav>
</div>

<!-- ===================== MAIN CONTENT ===================== -->
<div class="main-content">
  <div class="container-fluid p-1">

    <!-- Header Card -->
    <div class="card p-4 mb-4">
      <div class="d-flex flex-wrap justify-content-between align-items-center mb-3">
        <h4 class="fw-semibold text-dark">
          <i class="bi bi-exclamation-circle-fill me-2 text-success"></i>Special Waste Pickup Requests
        </h4>
        <span class="badge bg-success fs-6" id="requestCount">0 Requests</span>
      </div>
<!-- Filter Dropdown -->
<div class="d-flex justify-content-end mb-3">
  <div class="dropdown">
    <button class="btn btn-outline-success dropdown-toggle" type="button" id="filterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-funnel-fill me-2"></i>Filter Requests
    </button>
    <div class="dropdown-menu dropdown-menu-end p-3 shadow" style="min-width: 250px;">
      <div class="mb-2">
        <label class="form-label fw-semibold">Status</label>
        <select id="statusFilter" class="form-select">
          <option value="All">All</option>
          <option value="Pending">Pending</option>
          <option value="Scheduled">Scheduled</option>
          <option value="Completed">Completed</option>
          <option value="Rejected">Rejected</option>
        </select>
      </div>

      <div class="mb-2">
        <label class="form-label fw-semibold">Date</label>
        <select id="dateFilter" class="form-select mb-1">
          <option value="All">All</option>
          <option value="Today">Today</option>
          <option value="Last7Days">Last 7 Days</option>
          <option value="Last30Days">Last 30 Days</option>
          <option value="Custom">Custom</option>
        </select>
        <input type="date" id="customStartDate" class="form-control form-control-sm d-none mb-1" placeholder="Start Date">
        <input type="date" id="customEndDate" class="form-control form-control-sm d-none" placeholder="End Date">
      </div>

      <div class="d-flex justify-content-between mt-3">
        <button class="btn btn-success btn-sm w-100" id="filterBtn">
          <i class="bi bi-check-circle me-1"></i>Apply
        </button>
      </div>
    </div>
  </div>
</div>


<!-- Requests Table -->
<div class="table-responsive">
  <table class="table table-bordered table-striped align-middle text-center" id="requestsTable">

          <thead class="table-success">

      <tr>
        <th>#</th>
        <th>Resident</th>
        <th>Classification</th>
        <th>Waste Type</th>
        <th>Description</th>
        <th>Preferred Date</th>
        <th>Status</th>
        <th class="text-center">Actions</th>
      </tr>
    </thead>
    <tbody>
      <!-- JS will populate -->
    </tbody>
  </table>
</div>


<!-- ===================== MODAL ===================== -->
<div class="modal fade" id="requestModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Special Pickup Request Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <div class="row mb-3">
          <div class="col-md-6">
            <p><span class="modal-label">Resident:</span> <span id="modalResident"></span></p>
            <p><span class="modal-label">Classification:</span> <span id="modalClassification"></span></p>
            <p><span class="modal-label">Waste Type:</span> <span id="modalWasteType"></span></p>
            <p><span class="modal-label">Quantity / Description:</span> <span id="modalDescription"></span></p>
          </div>
          <div class="col-md-6">
            <p><span class="modal-label">Pickup Address:</span> <span id="modalAddress"></span></p>
            <p><span class="modal-label">Preferred Date:</span> <span id="modalDate"></span></p>
            <p><span class="modal-label">Current Status:</span> <span id="modalStatus"></span></p>
          </div>
        </div>

        <hr>

        <div id="adminActionsSection">
          <h6 class="fw-bold mb-2">Admin Actions</h6>

          <div class="mb-3">
            <label class="form-label">Pickup Date (if rescheduling)</label>
            <input type="date" id="newPickupDate" class="form-control">
          </div>

          <div class="mb-3">
            <label class="form-label">Assign Collector</label>
            <select class="form-select" id="collectorSelect">
              <option value="">-- Select Collector --</option>
              <option value="Juan Dela Cruz">Juan Dela Cruz</option>
              <option value="Maria Santos">Maria Santos</option>
              <option value="Pedro Ramirez">Pedro Ramirez</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">Remarks (if rejecting)</label>
            <textarea id="adminRemarks" class="form-control" rows="3" placeholder="Enter reason or notes..."></textarea>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-danger" id="rejectBtn">
          <i class="bi bi-x-circle me-1"></i> Reject
        </button>
        <button class="btn btn-success" id="approveBtn">
          <i class="bi bi-check-circle me-1"></i> Approve & Schedule
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ===================== BOOTSTRAP JS ===================== -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
let specialPickupRequests = [
  { id: 1, resident: "Ana Reyes", classification: "Biodegradable", wasteType: "Garden Waste", description: "Tree branches and leaves", preferredDate: "2026-02-03", address: "Brgy. Isabang, Sariaya", status: "Pending", assignedCollector: null, remarks: null },
  { id: 2, resident: "Mark Villanueva", classification: "Non-Biodegradable", wasteType: "Electronic Waste", description: "Broken TV and computer monitor", preferredDate: "2026-02-04", address: "Brgy. Canda, Sariaya", status: "Pending", assignedCollector: null, remarks: null },
  { id: 3, resident: "Grace Lim", classification: "Non-Biodegradable", wasteType: "Hazardous Waste", description: "Paint cans and chemical containers", preferredDate: "2026-02-05", address: "Brgy. Lutucan, Sariaya", status: "Scheduled", assignedCollector: "Juan Dela Cruz", remarks: null }
];

let selectedRequestId = null;

document.addEventListener("DOMContentLoaded", () => {
  renderRequestsTable();

  // FILTER ELEMENTS
  const statusFilter = document.getElementById("statusFilter");
  const dateFilter = document.getElementById("dateFilter");
  const customStart = document.getElementById("customStartDate");
  const customEnd = document.getElementById("customEndDate");
  const filterBtn = document.getElementById("filterBtn");

  // Show/hide custom date inputs
  dateFilter.addEventListener("change", () => {
    if (dateFilter.value === "Custom") {
      customStart.classList.remove("d-none");
      customEnd.classList.remove("d-none");
    } else {
      customStart.classList.add("d-none");
      customEnd.classList.add("d-none");
      renderRequestsTable();
    }
  });

  // Apply filter button
  filterBtn.addEventListener("click", () => {
    renderRequestsTable();
    // Close dropdown automatically
    const dropdown = bootstrap.Dropdown.getInstance(document.getElementById("filterDropdown"));
    dropdown?.hide();
  });

  // Also re-render table if status or custom dates change
  statusFilter.addEventListener("change", renderRequestsTable);
  customStart.addEventListener("change", renderRequestsTable);
  customEnd.addEventListener("change", renderRequestsTable);
});

// ===================== RENDER TABLE WITH FILTERS =====================
function renderRequestsTable() {
  const tableBody = document.querySelector("#requestsTable tbody");
  tableBody.innerHTML = "";

  const statusValue = document.getElementById("statusFilter")?.value || "All";
  const dateValue = document.getElementById("dateFilter")?.value || "All";
  const startDate = document.getElementById("customStartDate")?.value;
  const endDate = document.getElementById("customEndDate")?.value;

  const today = new Date();

  const filteredRequests = specialPickupRequests.filter(request => {
    // STATUS FILTER
    if (statusValue !== "All" && request.status !== statusValue) return false;

    // DATE FILTER
    const requestDate = new Date(request.preferredDate);
    switch (dateValue) {
      case "Today":
        return requestDate.toDateString() === today.toDateString();
      case "Last7Days":
        const last7 = new Date(today);
        last7.setDate(today.getDate() - 7);
        return requestDate >= last7 && requestDate <= today;
      case "Last30Days":
        const last30 = new Date(today);
        last30.setDate(today.getDate() - 30);
        return requestDate >= last30 && requestDate <= today;
      case "Custom":
        if (startDate && endDate) {
          const s = new Date(startDate);
          const e = new Date(endDate);
          e.setHours(23, 59, 59); // include full end day
          return requestDate >= s && requestDate <= e;
        }
        return true;
      default:
        return true;
    }
  });

  filteredRequests.forEach((request, index) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${index + 1}</td>
      <td>${request.resident}</td>
      <td>${request.classification}</td>
      <td>${request.wasteType}</td>
      <td>${request.description}</td>
      <td>${request.preferredDate}</td>
      <td>${getStatusBadge(request.status)}</td>
      <td class="text-center">
        <button class="btn btn-sm btn-outline-primary" onclick="openRequestModal(${request.id})">
          <i class="bi bi-eye"></i> View
        </button>
      </td>
    `;
    tableBody.appendChild(tr);
  });

  document.getElementById("requestCount").textContent = `${filteredRequests.length} Requests`;
}

// ===================== EXISTING FUNCTIONS =====================
function getStatusBadge(status) {
  const classMap = {
    "Pending": "pending",
    "Approved": "approved",
    "Scheduled": "scheduled",
    "Completed": "completed",
    "Rejected": "rejected"
  };
  const badgeClass = classMap[status] || "secondary";
  return `<span class="badge-status ${badgeClass}">${status}</span>`;
}

function openRequestModal(id) {
  const request = specialPickupRequests.find(r => r.id === id);
  if (!request) return;

  selectedRequestId = id;

  document.getElementById("modalResident").textContent = request.resident;
  document.getElementById("modalClassification").textContent = request.classification;
  document.getElementById("modalWasteType").textContent = request.wasteType;
  document.getElementById("modalDescription").textContent = request.description;
  document.getElementById("modalAddress").textContent = request.address;
  document.getElementById("modalDate").textContent = request.preferredDate;
  document.getElementById("modalStatus").innerHTML = getStatusBadge(request.status);

  document.getElementById("newPickupDate").value = request.preferredDate || "";
  document.getElementById("collectorSelect").value = request.assignedCollector || "";
  document.getElementById("adminRemarks").value = request.remarks || "";

  new bootstrap.Modal(document.getElementById("requestModal")).show();
}

document.getElementById("approveBtn").addEventListener("click", () => {
  if (selectedRequestId === null) return;
  const newDate = document.getElementById("newPickupDate").value;
  const collector = document.getElementById("collectorSelect").value;
  if (!collector) { alert("Please assign a collector before approving."); return; }

  const request = specialPickupRequests.find(r => r.id === selectedRequestId);
  if (!request) return;

  request.status = "Scheduled";
  request.preferredDate = newDate || request.preferredDate;
  request.assignedCollector = collector;
  request.remarks = null;

  alert(`Request approved and assigned to ${collector}.`);
  closeModal();
  renderRequestsTable();
});

document.getElementById("rejectBtn").addEventListener("click", () => {
  if (selectedRequestId === null) return;
  const remarks = document.getElementById("adminRemarks").value.trim();
  if (!remarks) { alert("Please provide a reason for rejection."); return; }

  const request = specialPickupRequests.find(r => r.id === selectedRequestId);
  if (!request) return;

  request.status = "Rejected";
  request.remarks = remarks;
  request.assignedCollector = null;

  alert("Request has been rejected.");
  closeModal();
  renderRequestsTable();
});

function closeModal() {
  const modalElement = document.getElementById("requestModal");
  const modalInstance = bootstrap.Modal.getInstance(modalElement);
  modalInstance.hide();
}

function markAsCompleted(id) {
  const request = specialPickupRequests.find(r => r.id === id);
  if (!request) return;
  request.status = "Completed";
  renderRequestsTable();
}
</script>
</body> </html>