<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BasuraTrack Sariaya - Routes & Schedules</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Flatpickr CSS -->
  <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet">
  <link rel="stylesheet" href="schedule.css">
  <style>
    .dropdown-checkbox .dropdown-menu { padding: 10px; max-height: 200px; overflow-y: auto; }
    .dropdown-checkbox .form-check { margin-bottom: 5px; }
    .dropdown-checkbox .select-all-btn { font-size: 0.85rem; text-align: left; padding-left: 0; }
  </style>
</head>
<body>

<!-- Top Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark fixed-top" style="height:70px;">
  <div class="container-fluid">
    <a class="navbar-brand d-flex align-items-center" href="#">
      <img src="logo.png" alt="BasuraTrack Logo" style="height:40px; width:auto;">
    </a>

 <ul class="navbar-nav ms-auto align-items-center">
      <li class="nav-item me-3">
        <a class="nav-link" href="notification.html"><i class="bi bi-bell-fill"></i></a>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="profileDropdown" data-bs-toggle="dropdown">
          <i class="bi bi-person-circle"></i> Admin
        </a>
        <ul class="dropdown-menu dropdown-menu-end">
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item text-center" href="#" id="logoutBtn">Logout <i class="bi bi-box-arrow-right me-1"></i></a></li>
        </ul>
      </li>
    </ul>
  </div>
</nav>

<div class="sidebar">
  <nav class="nav flex-column">
    <a class="nav-link" href="dashboard.html"><i class="bi bi-house-door-fill me-2"></i> Dashboard</a>
    <a class="nav-link" href="schedule.html"><i class="bi bi-map-fill me-2"></i> Routes & Schedules</a>
    <a class="nav-link" href="trucks.html"><i class="bi bi-truck-front-fill me-2"></i> Trucks & Collectors</a>
    <a class="nav-link" href="collection.html"><i class="bi bi-trash-fill me-2"></i> Collection Records</a>
    <a class="nav-link active" href="special.html"><i class="bi bi-exclamation-circle-fill me-2"></i> Special Pickup</a>
    <a class="nav-link" href="resident.html"><i class="bi bi-file-earmark-text-fill me-2"></i> Resident Reports</a>
    <a class="nav-link" href="analytics.html"><i class="bi bi-bar-chart-fill me-2"></i> Analytics & Reports</a>
    <a class="nav-link" href="announcements.html"><i class="bi bi-megaphone-fill me-2"></i> Announcements</a>
    <a class="nav-link" href="news.html"><i class="bi bi-newspaper me-2"></i> News & Articles</a>
    <a class="nav-link" href="user.html"><i class="bi bi-people-fill me-2"></i> User Management</a>
    <a class="nav-link" href="settings.html"><i class="bi bi-gear-fill me-2"></i> Settings</a>
  </nav>
</div>

<div class="main-content p-4">
  <!-- ROUTES TABLE -->
  <div class="card mb-4">
    <div class="card-body">
      <h4 class="card-title"><i class="bi bi-map me-2 text-success"></i>Route Management</h4>
      <div class="d-flex justify-content-end align-items-center gap-2 my-2">
        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addRouteModal"><i class="bi bi-plus-circle me-1"></i> Add Route</button>
        <select id="routeFilter" class="form-select w-auto">
          <option value="">All Routes</option>
        </select>
      </div>

      <div class="table-responsive">
        <table class="table table-bordered align-middle">
          <thead class="table-success">
            <tr>
              <th>RouteID</th>
              <th>Route Name</th>
              <th>Barangay</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="routesTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- SCHEDULES TABLE -->
  <div class="card">
    <div class="card-body">
      <h4 class="card-title"><i class="bi bi-calendar-check-fill me-2 text-success"></i>Schedule Management</h4>
<!-- FILTER + ADD BUTTON ROW -->
<div class="d-flex justify-content-end align-items-center gap-2 mb-3">
  <!-- Add Schedule Button -->
  <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addScheduleModal">
    <i class="bi bi-plus-circle me-1"></i> Add Schedule
  </button>

  <!-- Filter Records Dropdown -->
  <div class="dropdown">
    <button class="btn btn-outline-success dropdown-toggle" type="button" id="filterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-funnel-fill me-1"></i> Filter Records
    </button>
    <div class="dropdown-menu p-3" style="width:300px;">
      <div class="mb-2">
        <label class="form-label">Route</label>
        <select id="scheduleRouteFilter" class="form-select">
          <option value="">All Routes</option>
        </select>
      </div>
      <div class="mb-2">
        <label class="form-label">Date</label>
        <input type="text" id="scheduleDateFilter" class="form-control" placeholder="Select Date">
      </div>
      <div class="d-flex justify-content-end gap-2">
        <button class="btn btn-secondary btn-sm" id="resetScheduleFilter">Reset</button>
        <button class="btn btn-success btn-sm" id="applyScheduleFilter">Apply</button>
      </div>
    </div>
  </div>
</div>


      <div class="table-responsive">
        <table class="table table-bordered align-middle">
          <thead class="table-success">
            <tr>
              <th>ScheduleID</th>
              <th>Route Name</th>
              <th>Barangay</th>
              <th>Truck ID</th>
              <th>Collector</th>
              <th>Date</th>
              <th>Time</th>
              <th>Garbage Type</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="scheduleTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Add/Edit Route Modal -->
<div class="modal fade" id="addRouteModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="routeModalTitle">Add Route</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="routeForm">
          <div class="mb-3">
            <label class="form-label">Route Name</label>
            <input type="text" class="form-control" id="routeName" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Barangay</label>
            <input type="text" class="form-control" id="barangayName" required>
          </div>
          <div class="text-center"><button type="submit" class="btn btn-success px-5">Save</button></div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Add/Edit Schedule Modal -->
<div class="modal fade" id="addScheduleModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="scheduleModalTitle">Add Schedule</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="scheduleForm">
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label">Route Name</label>
              <select id="scheduleRouteName" class="form-select" required></select>
            </div>
            <div class="col-md-6">
              <label class="form-label">Barangay</label>
              <select id="scheduleBarangay" class="form-select" required></select>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-6"><label class="form-label">Truck ID</label><input type="number" class="form-control" id="truckId" min="1" required></div>
            <div class="col-md-6"><label class="form-label">Collector</label><input type="text" class="form-control" id="collectorName" required></div>
          </div>
          <div class="row mb-3">
            <div class="col-md-6"><label class="form-label">Date</label><input type="text" class="form-control" id="collectionDate" required></div>
            <div class="col-md-3"><label class="form-label">Start Time</label><input type="time" class="form-control" id="startTime" required></div>
            <div class="col-md-3"><label class="form-label">End Time</label><input type="time" class="form-control" id="endTime" required></div>
          </div>
          <div class="mb-3"><label class="form-label">Garbage Type</label><input type="text" class="form-control" id="remarks" required></div>
          <div class="text-center"><button type="submit" class="btn btn-success px-5">Save</button></div>
        </form>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  let routes = [
    {id:1, name:"Route 1", barangay:"Barangay 1"},
    {id:2, name:"Route 2", barangay:"Barangay 2"},
    {id:3, name:"Route 3", barangay:"Barangay 3"},
    {id:4, name:"Route 4", barangay:"Barangay 4"}
  ];
  let schedules = [
    {id:1, routeName:"Route 1", barangay:"Barangay 1", truck:1, collector:"Juan", date:"2025-10-20", start:"07:00", end:"11:00", type:"Recyclable"}
  ];

  let editRouteId = null;
  let editScheduleId = null;

  const routesTableBody = document.getElementById("routesTableBody");
  const scheduleTableBody = document.getElementById("scheduleTableBody");
  const routeFilter = document.getElementById("routeFilter");
  const scheduleRouteFilter = document.getElementById("scheduleRouteFilter");
  const scheduleDateFilter = document.getElementById("scheduleDateFilter");
  const resetScheduleFilter = document.getElementById("resetScheduleFilter");
  const applyScheduleFilter = document.getElementById("applyScheduleFilter");
  const scheduleRouteName = document.getElementById("scheduleRouteName");
  const scheduleBarangay = document.getElementById("scheduleBarangay");

  flatpickr("#collectionDate",{dateFormat:"Y-m-d"});
  flatpickr("#scheduleDateFilter",{dateFormat:"Y-m-d"});

  function renderRoutes(filter="") {
    routesTableBody.innerHTML = "";
    let filtered = routes.filter(r => !filter || r.name===filter);
    filtered.forEach(r=>{
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${r.id}</td>
        <td>${r.name}</td>
        <td>${r.barangay}</td>
        <td>
          <button class="btn btn-warning btn-sm edit-route">Edit</button>
          <button class="btn btn-danger btn-sm delete-route">Delete</button>
        </td>`;
      routesTableBody.appendChild(row);

      row.querySelector(".edit-route").addEventListener("click", ()=>{
        editRouteId = r.id;
        document.getElementById("routeModalTitle").textContent = "Edit Route";
        document.getElementById("routeName").value = r.name;
        document.getElementById("barangayName").value = r.barangay;
        new bootstrap.Modal(document.getElementById("addRouteModal")).show();
      });

      row.querySelector(".delete-route").addEventListener("click", ()=>{
        if(confirm("Are you sure to delete this route?")){
          const deletedRoute = routes.find(route=>route.id===r.id);
          schedules = schedules.filter(sch=>sch.routeName !== deletedRoute.name);
          routes = routes.filter(route=>route.id!==r.id);
          renderRoutes(routeFilter.value);
          populateRouteFilters();
          renderSchedules();
        }
      });
    });
  }

  function renderSchedules(routeVal="", dateVal="") {
    scheduleTableBody.innerHTML = "";
    schedules.filter(s=>{
      return (!routeVal || s.routeName===routeVal) && (!dateVal || s.date===dateVal);
    }).forEach(s=>{
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${s.id}</td>
        <td>${s.routeName}</td>
        <td>${s.barangay}</td>
        <td>${s.truck}</td>
        <td>${s.collector}</td>
        <td>${s.date}</td>
        <td>${s.start} - ${s.end}</td>
        <td>${s.type}</td>
        <td>
          <button class="btn btn-warning btn-sm edit-schedule">Edit</button>
          <button class="btn btn-danger btn-sm delete-schedule">Delete</button>
        </td>`;
      scheduleTableBody.appendChild(row);

      row.querySelector(".edit-schedule").addEventListener("click", ()=>{
        editScheduleId = s.id;
        document.getElementById("scheduleModalTitle").textContent = "Edit Schedule";
        scheduleRouteName.value = s.routeName;
        populateBarangayOptions(s.routeName);
        scheduleBarangay.value = s.barangay;
        document.getElementById("truckId").value = s.truck;
        document.getElementById("collectorName").value = s.collector;
        document.getElementById("collectionDate").value = s.date;
        document.getElementById("startTime").value = s.start;
        document.getElementById("endTime").value = s.end;
        document.getElementById("remarks").value = s.type;
        new bootstrap.Modal(document.getElementById("addScheduleModal")).show();
      });

      row.querySelector(".delete-schedule").addEventListener("click", ()=>{
        if(confirm("Are you sure to delete this schedule?")){
          schedules = schedules.filter(schedule=>schedule.id!==s.id);
          renderSchedules(routeVal, dateVal);
        }
      });
    });
  }

  function populateRouteFilters() {
    let routeNames = [...new Set(routes.map(r=>r.name))];
    routeFilter.innerHTML = '<option value="">All Routes</option>' + routeNames.map(n=>`<option value="${n}">${n}</option>`).join('');
    scheduleRouteFilter.innerHTML = '<option value="">All Routes</option>' + routeNames.map(n=>`<option value="${n}">${n}</option>`).join('');
    scheduleRouteName.innerHTML = '<option value="">Select Route</option>' + routeNames.map(n=>`<option value="${n}">${n}</option>`).join('');
  }

  function populateBarangayOptions(route) {
    const barangays = routes.filter(r=>r.name===route).map(r=>r.barangay);
    scheduleBarangay.innerHTML = barangays.map(b=>`<option value="${b}">${b}</option>`).join('');
  }

  scheduleRouteName.addEventListener("change",()=>populateBarangayOptions(scheduleRouteName.value));

  // Add/Edit Route
  document.getElementById("routeForm").addEventListener("submit", e=>{
    e.preventDefault();
    const name = document.getElementById("routeName").value.trim();
    const barangay = document.getElementById("barangayName").value.trim();
    if(editRouteId){
      const route = routes.find(r=>r.id===editRouteId);
      const oldName = route.name;
      route.name = name;
      route.barangay = barangay;
      schedules.forEach(sch=>{
        if(sch.routeName===oldName) sch.routeName=name;
      });
      editRouteId = null;
    } else {
      const newId = routes.length ? Math.max(...routes.map(r=>r.id))+1 : 1;
      routes.push({id:newId, name, barangay});
    }
    renderRoutes();
    populateRouteFilters();
    renderSchedules();
    bootstrap.Modal.getInstance(document.getElementById("addRouteModal")).hide();
    e.target
.reset();
document.getElementById("routeModalTitle").textContent = "Add Route";
});

// Add/Edit Schedule
document.getElementById("scheduleForm").addEventListener("submit", e=>{
e.preventDefault();
const routeNameVal = scheduleRouteName.value;
const barangayVal = scheduleBarangay.value;
const truckVal = document.getElementById("truckId").value;
const collectorVal = document.getElementById("collectorName").value;
const dateVal = document.getElementById("collectionDate").value;
const startVal = document.getElementById("startTime").value;
const endVal = document.getElementById("endTime").value;
const remarksVal = document.getElementById("remarks").value;
if(startVal && endVal && endVal <= startVal){
  alert("End time cannot be earlier than or equal to Start time!");
  return;
}

if(editScheduleId){
  const s = schedules.find(sch=>sch.id===editScheduleId);
  s.routeName = routeNameVal;
  s.barangay = barangayVal;
  s.truck = truckVal;
  s.collector = collectorVal;
  s.date = dateVal;
  s.start = startVal;
  s.end = endVal;
  s.type = remarksVal;
  editScheduleId = null;
} else {
  const newId = schedules.length ? Math.max(...schedules.map(s=>s.id))+1 : 1;
  schedules.push({
    id:newId,
    routeName:routeNameVal,
    barangay:barangayVal,
    truck:truckVal,
    collector:collectorVal,
    date:dateVal,
    start:startVal,
    end:endVal,
    type:remarksVal
  });
}
renderSchedules();
bootstrap.Modal.getInstance(document.getElementById("addScheduleModal")).hide();
e.target.reset();
document.getElementById("scheduleModalTitle").textContent = "Add Schedule";
});
// Filter buttons (Apply & Reset)
applyScheduleFilter.addEventListener("click", ()=>{
const routeVal = scheduleRouteFilter.value;
const dateVal = scheduleDateFilter.value;
renderSchedules(routeVal, dateVal);
});

resetScheduleFilter.addEventListener("click",()=>{
scheduleRouteFilter.value="";
scheduleDateFilter.value="";
renderSchedules();
});

routeFilter.addEventListener("change", ()=> renderRoutes(routeFilter.value));

renderRoutes();
populateRouteFilters();
renderSchedules();
});
</script>

</body> </html> 